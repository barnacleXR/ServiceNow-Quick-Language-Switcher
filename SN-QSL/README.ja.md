[English](README.md) | [简体中文](README.zh-CN.md) | [日本語](README.ja.md) | [Français](README.fr.md)

# ServiceNow クイック言語スイッチャー (QLS)

ServiceNow Polaris UIヘッダーにボタンを追加し、インストールされている言語を素早く切り替えることができるブラウザ拡張機能です。

> **互換性に関する注意**：この拡張機能は **Next Experience UI** 専用に設計されており、クラシックUI（UI16）はサポートしていません。

---

### 主な機能

-   **シームレスな統合**: ServiceNowヘッダーに直接言語切り替えアイコンを追加し、簡単にアクセスできます。
-   **スマートな切り替え**:
    -   **2つの言語**が設定されている場合、ボタンはワンクリックで他の言語に切り替えるトグルとして機能します。
    -   **3つ以上の言語**が利用可能な場合、クリーンでシンプルなモーダルが表示され、リストから選択できます。
-   **自動言語検出**: ServiceNowの個人設定パネルから利用可能な言語を自動的に取得します。
-   **エラーハンドリング**: ServiceNowインスタンスで複数の言語が有効になっていない場合、明確なフィードバックを提供します。

### 開発の動機

多言語環境で作業するServiceNow開発者にとって、ユーザープロファイルから頻繁に言語を切り替えるのは面倒なプロセスです。`sn-utils` のようなツールはコマンドライン (`/lang <言語コード>`) での切り替えを提供しますが、それでも手動での入力が必要です。この拡張機能は、このワークフローをシンプルなワンクリックソリューションに合理化し、繰り返し行われる手動の手順を不要にすることを目的として作成されました。

### 仕組み

この拡張機能は、UI要素を注入するコンテンツスクリプトと、サンドボックスの制限を回避してコアロジックを処理するバックグラウンドスクリプトで構成されています。

1.  **UIの注入 (`content-script.js`)**:
    -   `MutationObserver` を使用して、ServiceNow Polarisヘッダーが読み込まれるのを待ちます。
    -   ヘッダーの準備が整うと、新しい言語切り替えアイコン (`<now-icon icon="translated-text-fill">`) をヘッダーのコントロールゾーンに注入します。
    -   このスクリプトはアイコンのクリックを監視し、クリックされるとバックグラウンドスクリプトにメッセージを送信して利用可能な言語のリストを取得します。
    -   3つ以上の言語が返された場合、`custom-modal.css` のスタイルを使用して言語選択モーダルを動的に作成・表示します。

2.  **コアロジック (`background.js`)**:
    -   バックグラウンドスクリプトは、コンテンツスクリプトからのメッセージをリッスンします。
    -   **言語の取得**: `getLanguages` リクエストを受け取ると、`chrome.scripting.executeScript` APIを使用して、ページの `MAIN` ワールドで関数 (`getAvailableLanguages`) を実行し、UIを自動操作して言語リストを取得します。
    -   **言語の設定**: `setLanguage` リクエスト（ターゲット言語ID付き）を受け取ると、別の関数 (`switchLanguageTo`) を注入します。この関数は、ServiceNowの内部API（`/api/now/ui/concoursepicker/language`）に `PUT` リクエストを送信してセッション言語を変更し、ページをリロードします。

### インストール方法

1.  このリポジトリをダウンロードまたはクローンします。
2.  Google Chromeを開き、`chrome://extensions/` にアクセスします。
3.  右上隅のトグルスイッチで「**デベロッパーモード**」を有効にします。
4.  「**パッケージ化されていない拡張機能を読み込む**」ボタンをクリックします。
5.  これらのファイルを保存したディレクトリ（`SN-QLS` またはプロジェクトフォルダ）を選択します。
6.  これで拡張機能がインストールされ、ServiceNowページで有効になります。
